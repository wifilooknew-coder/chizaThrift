<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>ChizaThrift</title>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<style>
body {font-family:"Segoe UI", sans-serif; background: linear-gradient(to bottom,#ffe6f0,#fff); margin:0; padding:20px;}
h1{text-align:center;color:#d63384;margin-bottom:20px;font-size:2.5em;text-shadow:1px 1px #fff;}
.tabs{text-align:center;margin-bottom:20px;}
.tabs button{padding:10px 20px;margin:0 5px;cursor:pointer;border:none;border-radius:20px;background:#f8bbd0;color:#fff;font-weight:bold;box-shadow:0 3px 6px rgba(0,0,0,0.2);}
.tabs button.active{background:#ec407a;}
.tab-content{display:none;}
.tab-content.active{display:block;animation:fadeIn 0.5s;}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
table{border-collapse:collapse;width:100%;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 3px 8px rgba(0,0,0,0.15);}
th{background:#f48fb1;color:white;padding:10px;}
td{border:1px solid #f8bbd0;padding:8px;text-align:center;}
td input,td select,td textarea{width:100%;box-sizing:border-box;border:none;padding:4px;text-align:center;background:#fff0f6;border-radius:5px;}
td textarea{resize:vertical;min-height:40px;}
button.add-row,button#downloadExcel{margin-top:10px;padding:8px 14px;border:none;border-radius:10px;background:#f06292;color:white;font-weight:bold;cursor:pointer;box-shadow:0 3px 6px rgba(0,0,0,0.2);}
button.add-row:hover,button#downloadExcel:hover{background:#ec407a;}
button.delete-row{padding:5px 10px;border:none;border-radius:6px;background:#e57373;color:white;cursor:pointer;}
.total-box{font-weight:bold;margin-top:10px;padding:10px;background:#fff0f6;border:1px solid #f8bbd0;border-radius:8px;display:inline-block;}
</style>
</head>
<body>
<h1>ðŸŒ¸ ChizaThrift ðŸŒ¸</h1>

<div class="tabs">
  <button class="tab-btn active" onclick="openTab('pesanan')">Pesanan</button>
  <button class="tab-btn" onclick="openTab('pengeluaran')">Pengeluaran</button>
</div>

<div id="pesanan" class="tab-content active">
  <table id="tabelPesanan">
    <thead>
      <tr>
        <th>produk</th><th>nama</th><th>harga</th><th>pembayaran</th><th>status</th><th>penjual</th><th>ekspedisi</th><th>alamat</th><th>aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button class="add-row" onclick="tambahBarisPesanan()">+ Tambah Baris</button>
  <div class="total-box">Total: <span id="totalPesanan">Rp 0</span></div>
</div>

<div id="pengeluaran" class="tab-content">
  <table id="tabelPengeluaran">
    <thead>
      <tr><th>nama barang</th><th>harga</th><th>aksi</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <button class="add-row" onclick="tambahBarisPengeluaran()">+ Tambah Baris</button>
  <div class="total-box">Total: <span id="totalPengeluaran">Rp 0</span></div>
</div>

<!-- Tombol Download Excel -->
<div style="text-align:center;">
  <button id="downloadExcel" onclick="downloadExcel()">Download Excel</button>
</div>

<script>
function openTab(tabId){
  document.querySelectorAll('.tab-content').forEach(d=>d.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  event.target.classList.add('active');
}

function getAngka(str){return parseInt(str.replace(/[^0-9]/g,''))||0;}
function formatRupiah(input){let angka=input.value.replace(/[^,\d]/g,'');if(angka){input.value=new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',minimumFractionDigits:0}).format(angka);}simpanData();}
function hitungTotalPesanan(){let total=0;document.querySelectorAll("#tabelPesanan tbody tr").forEach(r=>{let h=r.cells[2].querySelector("input");let s=r.cells[4].querySelector("select");if(h&&s&&s.value==="Lunas")total+=getAngka(h.value);});document.getElementById("totalPesanan").innerText=new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',minimumFractionDigits:0}).format(total);}
function hitungTotalPengeluaran(){let total=0;document.querySelectorAll("#tabelPengeluaran tbody tr").forEach(r=>{let h=r.cells[1].querySelector("input");if(h)total+=getAngka(h.value);});document.getElementById("totalPengeluaran").innerText=new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',minimumFractionDigits:0}).format(total);}
function hapusBaris(btn){btn.parentElement.parentElement.remove();hitungTotalPesanan();hitungTotalPengeluaran();simpanData();}

function tambahBarisPesanan(d={}){let tbody=document.querySelector("#tabelPesanan tbody");let r=tbody.insertRow();r.innerHTML=`<td><input type="text" value="${d.produk||''}" oninput="simpanData()"></td>
<td><input type="text" value="${d.nama||''}" oninput="simpanData()"></td>
<td><input type="text" value="${d.harga||''}" onblur="formatRupiah(this);hitungTotalPesanan()" oninput="simpanData()"></td>
<td><select onchange="hitungTotalPesanan();simpanData()"><option ${d.pembayaran==='Cash'?'selected':''}>Cash</option><option ${d.pembayaran==='Transfer'?'selected':''}>Transfer</option><option ${d.pembayaran==='COD'?'selected':''}>COD</option></select></td>
<td><select onchange="hitungTotalPesanan();simpanData()"><option ${d.status==='Lunas'?'selected':''}>Lunas</option><option ${d.status==='Belum Lunas'?'selected':''}>Belum Lunas</option></select></td>
<td><select onchange="simpanData()"><option ${d.penjual==='Cici'?'selected':''}>Cici</option><option ${d.penjual==='Azanatun'?'selected':''}>Azanatun</option></select></td>
<td><select onchange="simpanData()"><option ${d.ekspedisi==='JNT'?'selected':''}>JNT</option><option ${d.ekspedisi==='JNE'?'selected':''}>JNE</option><option ${d.ekspedisi==='ShopeeXpress'?'selected':''}>ShopeeXpress</option></select></td>
<td><textarea oninput="simpanData()">${d.alamat||''}</textarea></td>
<td><button class="delete-row" onclick="hapusBaris(this)">Hapus</button></td>`;}

function tambahBarisPengeluaran(d={}){let tbody=document.querySelector("#tabelPengeluaran tbody");let r=tbody.insertRow();r.innerHTML=`<td><input type="text" value="${d.nama||''}" oninput="simpanData()"></td>
<td><input type="text" value="${d.harga||''}" onblur="formatRupiah(this);hitungTotalPengeluaran()" oninput="simpanData()"></td>
<td><button class="delete-row" onclick="hapusBaris(this)">Hapus</button></td>`;}

function simpanData(){
  const data={pesanan:[],pengeluaran:[]};
  document.querySelectorAll("#tabelPesanan tbody tr").forEach(r=>data.pesanan.push({
    produk:r.cells[0].querySelector("input").value,
    nama:r.cells[1].querySelector("input").value,
    harga:r.cells[2].querySelector("input").value,
    pembayaran:r.cells[3].querySelector("select").value,
    status:r.cells[4].querySelector("select").value,
    penjual:r.cells[5].querySelector("select").value,
    ekspedisi:r.cells[6].querySelector("select").value,
    alamat:r.cells[7].querySelector("textarea").value
  }));
  document.querySelectorAll("#tabelPengeluaran tbody tr").forEach(r=>data.pengeluaran.push({
    nama:r.cells[0].querySelector("input").value,
    harga:r.cells[1].querySelector("input").value
  }));
  localStorage.setItem("chizaData",JSON.stringify(data));
}

function muatData(){
  const data=JSON.parse(localStorage.getItem("chizaData")||'{"pesanan":[],"pengeluaran":[]}');
  if(data.pesanan.length>0) data.pesanan.forEach(i=>tambahBarisPesanan(i));
  else tambahBarisPesanan();
  if(data.pengeluaran.length>0) data.pengeluaran.forEach(i=>tambahBarisPengeluaran(i));
  else tambahBarisPengeluaran();
  hitungTotalPesanan();
  hitungTotalPengeluaran();
}

function downloadExcel(){
  const data=JSON.parse(localStorage.getItem("chizaData")||'{"pesanan":[],"pengeluaran":[]}');
  const wb=XLSX.utils.book_new();

  // Sheet Pesanan
  const wsPesanan=XLSX.utils.json_to_sheet(data.pesanan.map(r=>({
    Produk:r.produk,Nama:r.nama,Harga:r.harga,Pembayaran:r.pembayaran,
    Status:r.status,Penjual:r.penjual,Ekspedisi:r.ekspedisi,Alamat:r.alamat
  })));
  XLSX.utils.book_append_sheet(wb,wsPesanan,"Pesanan");

  // Sheet Pengeluaran
  const wsPengeluaran=XLSX.utils.json_to_sheet(data.pengeluaran.map(r=>({
    Nama_Barang:r.nama,Harga:r.harga
  })));
  XLSX.utils.book_append_sheet(wb,wsPengeluaran,"Pengeluaran");

  // Nama file otomatis dengan tanggal lengkap
  const today=new Date();
  const day=String(today.getDate()).padStart(2,'0');
  const monthNames=["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"];
  const month=monthNames[today.getMonth()];
  const year=today.getFullYear();
  const fileName=`${day}-${month}-${year}-Chiza.xlsx`;

  XLSX.writeFile(wb,fileName);
}

window.onload=muatData;
</script>
</body>
</html>
